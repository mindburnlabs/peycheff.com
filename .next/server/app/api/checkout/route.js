"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},1764:e=>{e.exports=require("util")},3093:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>_,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var r={};s.r(r),s.d(r,{GET:()=>m,POST:()=>d});var o=s(9303),a=s(8716),i=s(3131),n=s(7070),c=s(1059),u=s(5192);let p=new c.Z(process.env.STRIPE_SECRET_KEY||"",{apiVersion:"2025-08-27.basil"}),l=u.z.object({priceId:u.z.string().min(1,"Price ID is required"),productName:u.z.string().min(1,"Product name is required"),successUrl:u.z.string().optional(),cancelUrl:u.z.string().optional(),customerEmail:u.z.string().email().optional(),metadata:u.z.record(u.z.string(),u.z.string()).optional()});async function d(e){try{let t=await e.json(),s=l.parse(t),r=e.headers.get("origin")||"https://peycheff.com",o=await p.checkout.sessions.create({payment_method_types:["card"],line_items:[{price:s.priceId,quantity:1}],mode:"payment",success_url:s.successUrl||`${r}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:s.cancelUrl||`${r}/products?canceled=true`,customer_email:s.customerEmail,metadata:{product_name:s.productName,source:"peycheff.com",...s.metadata},billing_address_collection:"auto",allow_promotion_codes:!0,phone_number_collection:{enabled:!1},custom_fields:[{key:"company",label:{type:"custom",custom:"Company (Optional)"},type:"text",optional:!0},{key:"goal",label:{type:"custom",custom:"What are you hoping to achieve? (Optional)"},type:"text",optional:!0}]});return console.log(`Checkout session created: ${o.id} for ${s.productName}`),n.NextResponse.json({success:!0,sessionId:o.id,checkoutUrl:o.url})}catch(e){if(console.error("Stripe checkout error:",e),e instanceof u.z.ZodError)return n.NextResponse.json({success:!1,error:"Validation failed",details:e.issues.map(e=>e.message)},{status:400});if(e instanceof c.Z.errors.StripeError)return n.NextResponse.json({success:!1,error:e.message},{status:400});return n.NextResponse.json({success:!1,error:"An unexpected error occurred. Please try again."},{status:500})}}async function m(e){try{let{searchParams:t}=new URL(e.url),s=t.get("session_id");if(!s)return n.NextResponse.json({success:!1,error:"Session ID is required"},{status:400});let r=await p.checkout.sessions.retrieve(s);return n.NextResponse.json({success:!0,session:{id:r.id,status:r.status,payment_status:r.payment_status,customer_email:r.customer_details?.email,metadata:r.metadata,created:r.created,expires_at:r.expires_at}})}catch(e){return console.error("Session retrieval error:",e),n.NextResponse.json({success:!1,error:"Failed to retrieve session information"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/Users/ivan/Code/peycheff.com/app/api/checkout/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:x,serverHooks:y}=h,g="/api/checkout/route";function f(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[216,592],()=>s(3093));module.exports=r})();