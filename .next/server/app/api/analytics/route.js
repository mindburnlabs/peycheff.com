"use strict";(()=>{var e={};e.id=567,e.ids=[567],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9189:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>I,requestAsyncStorage:()=>_,routeModule:()=>v,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{GET:()=>A,OPTIONS:()=>y,POST:()=>f});var n=t(9303),o=t(8716),a=t(3131),i=t(7070),c=t(5192);let u=c.z.object({event:c.z.string(),properties:c.z.record(c.z.string(),c.z.any()).optional(),timestamp:c.z.string().optional(),userId:c.z.string().optional(),sessionId:c.z.string().optional(),url:c.z.string().optional(),userAgent:c.z.string().optional(),referrer:c.z.string().optional(),utm:c.z.object({source:c.z.string().optional(),medium:c.z.string().optional(),campaign:c.z.string().optional(),term:c.z.string().optional(),content:c.z.string().optional()}).optional()}),l=process.env.GA4_MEASUREMENT_ID||"G-XXXXXXXXXX",p=process.env.GA4_API_SECRET;async function d(e){if(!p)return console.warn("GA4_API_SECRET not configured, skipping GA4 tracking"),{success:!1,error:"GA4 not configured"};try{let r={measurement_id:l,api_secret:p,events:[{name:e.event,params:{...e.properties,session_id:e.sessionId,user_id:e.userId,page_location:e.url,user_agent:e.userAgent,page_referrer:e.referrer,...e.utm}}]},t=await fetch(`https://www.google-analytics.com/mp/collect?measurement_id=${l}&api_secret=${p}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok)throw Error(`GA4 API error: ${t.status} ${t.statusText}`);return{success:!0,data:await t.json()}}catch(e){return console.error("GA4 tracking error:",e),{success:!1,error:e.message}}}async function g(e){if(!process.env.META_PIXEL_ID)return console.warn("META_PIXEL_ID not configured, skipping Meta tracking"),{success:!1,error:"Meta Pixel not configured"};try{let r={event:e.event,event_id:`${e.event}_${Date.now()}`,user_data:{client_user_agent:e.userAgent,client_ip_address:e.ip},custom_data:e.properties,event_source_url:e.url,action_source:"website"};return console.log("Meta Pixel event:",r),{success:!0,data:r}}catch(e){return console.error("Meta Pixel tracking error:",e),{success:!1,error:e.message}}}async function m(e){try{let r={timestamp:e.timestamp||new Date().toISOString(),event:e.event,properties:e.properties,userId:e.userId,sessionId:e.sessionId,url:e.url,userAgent:e.userAgent,referrer:e.referrer,utm:e.utm,ip:e.ip};return console.log("Analytics event:",JSON.stringify(r)),{success:!0,data:r}}catch(e){return console.error("Analytics storage error:",e),{success:!1,error:e.message}}}async function f(e){try{let r=await e.json(),t=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"127.0.0.1",s=u.parse({...r,ip:t,userAgent:e.headers.get("user-agent")||"",url:r.url||e.headers.get("referer")||"",referrer:e.headers.get("referer")||""});s.timestamp||(s.timestamp=new Date().toISOString());let n=await Promise.allSettled([d(s),g(s),m(s)]),o=n.some(e=>"fulfilled"===e.status&&e.value.success);if(n.forEach((e,r)=>{"rejected"===e.status?console.error(`Analytics system ${r} failed:`,e.reason):e.value.success||console.error(`Analytics system ${r} error:`,e.value.error)}),o)return i.NextResponse.json({success:!0,message:"Event tracked successfully",eventId:`${s.event}_${Date.now()}`});return i.NextResponse.json({success:!1,error:"All tracking systems failed"},{status:500})}catch(e){if(console.error("Analytics tracking error:",e),e instanceof c.z.ZodError)return i.NextResponse.json({success:!1,error:"Validation failed",details:e.issues.map(e=>e.message)},{status:400});return i.NextResponse.json({success:!1,error:"An unexpected error occurred"},{status:500})}}async function A(e){try{let{searchParams:r}=new URL(e.url);if(r.get("api_key")!==process.env.ANALYTICS_API_KEY)return i.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let t={totalEvents:0,uniqueUsers:0,topPages:[],conversionRate:0,popularProducts:[],lastUpdated:new Date().toISOString(),message:"Analytics dashboard data - implement database queries to populate"};return i.NextResponse.json({success:!0,data:t})}catch(e){return console.error("Analytics retrieval error:",e),i.NextResponse.json({success:!1,error:"Failed to retrieve analytics data"},{status:500})}}async function y(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let v=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"/Users/ivan/Code/peycheff.com/app/api/analytics/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:h,serverHooks:w}=v,x="/api/analytics/route";function I(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[216,592],()=>t(9189));module.exports=s})();