"use strict";(()=>{var e={};e.id=893,e.ids=[893],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},3332:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>v,patchFetch:()=>S,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var r={};s.r(r),s.d(r,{GET:()=>p,OPTIONS:()=>m,POST:()=>d});var n=s(9303),a=s(8716),o=s(3131),i=s(7070),u=s(8605);let c=(0,u.createRateLimit)({windowMs:6e4,maxRequests:10,message:"Too many security stats requests"});function l(e){let t=e.headers.get("x-api-key"),r=e.headers.get("authorization"),n=t||r?.replace("Bearer ","");if(!n)return{valid:!1,reason:"Missing API key"};let a=process.env.SECURITY_API_KEY;if(!a)return{valid:!1,reason:"Security monitoring not configured"};let o=s(4770);try{if(!o.timingSafeEqual(Buffer.from(n,"utf8"),Buffer.from(a,"utf8")))return{valid:!1,reason:"Invalid API key"};return{valid:!0}}catch(e){return{valid:!1,reason:"Authentication error"}}}async function p(e){try{let t=(0,u.validateRequest)(e);if(!t.valid)return i.NextResponse.json({success:!1,error:"Invalid request",reason:t.reason},{status:400});let s=await c(e);if(!s.success)return i.NextResponse.json({success:!1,error:s.error},{status:s.statusCode,headers:{"Retry-After":s.retryAfter?.toString()||"60"}});let r=l(e);if(!r.valid)return i.NextResponse.json({success:!1,error:"Authentication failed",reason:r.reason},{status:401});let n=(0,u.getSecurityStats)(),a={uptime:process.uptime(),memoryUsage:process.memoryUsage(),platform:process.platform,nodeVersion:process.version,environment:"production",timestamp:new Date().toISOString()},o={ip:(0,u.getClientIP)(e),userAgent:e.headers.get("user-agent"),referer:e.headers.get("referer"),url:e.url,method:e.method};return i.NextResponse.json({success:!0,data:{security:n,system:a,request:o,generated_at:new Date().toISOString()}},{headers:{"X-RateLimit-Remaining":s.remaining?.toString()||"0","X-RateLimit-Reset":new Date(s.resetTime).toISOString(),"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","Cache-Control":"no-store, must-revalidate"}})}catch(e){return console.error("Security stats error:",e),i.NextResponse.json({success:!1,error:"Failed to retrieve security statistics"},{status:500})}}async function d(e){try{let t=(0,u.validateRequest)(e);if(!t.valid)return i.NextResponse.json({success:!1,error:"Invalid request",reason:t.reason},{status:400});let r=await c(e);if(!r.success)return i.NextResponse.json({success:!1,error:r.error},{status:r.statusCode,headers:{"Retry-After":r.retryAfter?.toString()||"60"}});let n=l(e);if(!n.valid)return i.NextResponse.json({success:!1,error:"Authentication failed",reason:n.reason},{status:401});let{action:a}=await e.json();switch(a){case"cleanup":let{cleanupRateLimitStore:o,cleanupSecurityEvents:p}=s(8605);return o(),p(),i.NextResponse.json({success:!0,message:"Security data cleanup completed",timestamp:new Date().toISOString()});case"test-alert":let{logSecurityEvent:d,SECURITY_EVENTS:m}=s(8605),f=await d({type:m.SUSPICIOUS_REQUEST,ip:(0,u.getClientIP)(e),url:"/api/security/stats",userAgent:e.headers.get("user-agent"),reason:"Test security alert from admin panel"});return i.NextResponse.json({success:!0,message:"Test security alert sent",eventId:f.id,timestamp:new Date().toISOString()});default:return i.NextResponse.json({success:!1,error:"Unknown action",availableActions:["cleanup","test-alert"]},{status:400})}}catch(e){return console.error("Security admin action error:",e),i.NextResponse.json({success:!1,error:"Failed to execute admin action"},{status:500})}}async function m(e){let t=e.headers.get("origin"),s=t&&["https://peycheff.com","https://www.peycheff.com"].includes(t);return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":s?t:"null","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-API-Key, X-Requested-With","Access-Control-Allow-Credentials":"true","Access-Control-Max-Age":"86400",Vary:"Origin"}})}let f=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/security/stats/route",pathname:"/api/security/stats",filename:"route",bundlePath:"app/api/security/stats/route"},resolvedPagePath:"/Users/ivan/Code/peycheff.com/app/api/security/stats/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:h}=f,v="/api/security/stats/route";function S(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[216,592],()=>s(3332));module.exports=r})();