"use strict";(()=>{var e={};e.id=818,e.ids=[818],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},5796:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>d,serverHooks:()=>S,staticGenerationAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{GET:()=>c,OPTIONS:()=>l,POST:()=>u});var s=t(9303),i=t(8716),n=t(3131),p=t(7070),a=t(8605);async function u(e){try{let r=(0,a.getClientIP)(e),t=e.headers.get("user-agent")||"",o=(0,a.validateRequest)(e);if(!o.valid)return await (0,a.logSecurityEvent)({type:a.SECURITY_EVENTS.SUSPICIOUS_REQUEST,ip:r,url:e.url,userAgent:t,method:e.method,reason:o.reason}),p.NextResponse.json({error:"Invalid request"},{status:400});let s=e.headers.get("content-type");if(s?.includes("application/csp-report")){let o=await e.text();try{let s=JSON.parse(o);if(!s["csp-report"])return p.NextResponse.json({error:"Invalid CSP report format"},{status:400});let i=s["csp-report"];return await (0,a.logSecurityEvent)({type:"csp_violation",ip:r,url:e.url,userAgent:t,method:e.method,details:{documentUri:i["document-uri"],violatedDirective:i["violated-directive"],blockedUri:i["blocked-uri"],originalPolicy:i["original-policy"],sourceFile:i["source-file"],lineNumber:i["line-number"],columnNumber:i["column-number"],scriptSample:i["script-sample"]}}),console.warn("\uD83D\uDEA8 CSP Violation Report:",{ip:r,documentUri:i["document-uri"],violatedDirective:i["violated-directive"],blockedUri:i["blocked-uri"],timestamp:new Date().toISOString()}),p.NextResponse.json({success:!0})}catch(e){return console.error("CSP report parse error:",e),p.NextResponse.json({error:"Invalid JSON in CSP report"},{status:400})}}if(s?.includes("application/reports+json")){let o=await e.text();try{let s=JSON.parse(o);if(!Array.isArray(s))return p.NextResponse.json({error:"Invalid report format"},{status:400});for(let o of s)"network-error"===o.type&&(await (0,a.logSecurityEvent)({type:"network_error",ip:r,url:e.url,userAgent:t,method:e.method,details:{reportType:o.type,reportUrl:o.url,reportMethod:o.method,reportStatus:o.status_code,reportAge:o.age,reportPhase:o.phase}}),console.warn("\uD83D\uDEA8 Network Error Report:",{ip:r,type:o.type,url:o.url,method:o.method,status:o.status_code,timestamp:new Date().toISOString()}));return p.NextResponse.json({success:!0})}catch(e){return console.error("Network report parse error:",e),p.NextResponse.json({error:"Invalid JSON in network report"},{status:400})}}let i=await e.json();if(!i.type||!i.details)return p.NextResponse.json({error:"Missing required report fields"},{status:400});return await (0,a.logSecurityEvent)({type:"security_report",ip:r,url:e.url,userAgent:t,method:e.method,details:{reportType:i.type,reportDetails:i.details,reportSeverity:i.severity||"medium",reportSource:i.source||"client"}}),console.info("\uD83D\uDCCA Security Report Received:",{ip:r,type:i.type,severity:i.severity||"medium",timestamp:new Date().toISOString()}),p.NextResponse.json({success:!0,message:"Security report received and processed",reportId:`report_${Date.now()}_${Math.random().toString(36).substr(2,9)}`})}catch(r){return console.error("Security report processing error:",r),await (0,a.logSecurityEvent)({type:a.SECURITY_EVENTS.SUSPICIOUS_REQUEST,ip:(0,a.getClientIP)(e),url:e.url,userAgent:e.headers.get("user-agent")||"",method:e.method,reason:"Report processing error",error:r instanceof Error?r.message:"Unknown error"}),p.NextResponse.json({error:"Failed to process security report"},{status:500})}}async function c(e){try{(0,a.getClientIP)(e);let r=(0,a.validateRequest)(e);if(!r.valid)return p.NextResponse.json({error:"Invalid request",reason:r.reason},{status:400});return p.NextResponse.json({endpoint:"/api/security/reports",supportedTypes:[{type:"csp-violation",contentType:"application/csp-report",description:"Content Security Policy violation reports"},{type:"network-error",contentType:"application/reports+json",description:"Network Error Logging reports"},{type:"security-report",contentType:"application/json",description:"Generic security reports",schema:{type:"string (required)",severity:"string (low|medium|high|critical, optional)",source:"string (optional)",details:"object (required)"}}],usage:{"CSP Reports":"POST with Content-Type: application/csp-report","Network Reports":"POST with Content-Type: application/reports+json","Security Reports":"POST with Content-Type: application/json"},timestamp:new Date().toISOString()})}catch(e){return console.error("Security report info error:",e),p.NextResponse.json({error:"Failed to retrieve report information"},{status:500})}}async function l(e){let r=e.headers.get("origin"),t=r&&["https://peycheff.com","https://www.peycheff.com"].includes(r);return new p.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":t?r:"null","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, X-Requested-With","Access-Control-Allow-Credentials":"true","Access-Control-Max-Age":"86400",Vary:"Origin"}})}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/security/reports/route",pathname:"/api/security/reports",filename:"route",bundlePath:"app/api/security/reports/route"},resolvedPagePath:"/Users/ivan/Code/peycheff.com/app/api/security/reports/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:m,serverHooks:S}=d,g="/api/security/reports/route";function h(){return(0,n.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:m})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[216,592],()=>t(5796));module.exports=o})();